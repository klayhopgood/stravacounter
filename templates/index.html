<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Preferences</title>
</head>
<body>
    <h1>User Preferences</h1>
    <form action="/update_preferences" method="POST">
        <fieldset>
            <legend>Free Options</legend>
            <label>
                <input type="checkbox" name="days_run" {% if preferences.days_run %}checked{% endif %}>
                Days run this year
            </label><br>
            <label>
                <input type="checkbox" name="total_kms" {% if preferences.total_kms %}checked{% endif %}>
                Total kms run this year
            </label><br>
            <label>
                <input type="checkbox" name="avg_kms" {% if preferences.avg_kms %}checked{% endif %}>
                Average kms per week (last 4 weeks)
            </label><br>
            <label>
                <input type="checkbox" name="pizza_slices_burnt" {% if preferences.pizza_slices_burnt %}checked{% endif %}>
                Pizza slices burnt
            </label><br>
        </fieldset>

        <fieldset>
            <legend>Paid Options</legend>
            <label>
                <input type="checkbox" name="total_elevation" {% if preferences.total_elevation %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Total elevation gain this year
            </label><br>
            <label>
                <input type="checkbox" name="avg_elevation" {% if preferences.avg_elevation %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Average elevation per week (last 4 weeks)
            </label><br>
            <label>
                <input type="checkbox" name="avg_pace" {% if preferences.avg_pace %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Average pace
            </label><br>
            <label>
                <input type="checkbox" name="avg_pace_per_week" {% if preferences.avg_pace_per_week %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Average pace per week
            </label><br>
            <label>
                <input type="checkbox" name="beers_burnt" {% if preferences.beers_burnt %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Beers burnt
            </label><br>
            <label>
                <input type="checkbox" name="remove_promo" {% if preferences.remove_promo %}checked{% endif %} {% if not preferences.is_paid_user %}disabled{% endif %}>
                Remove promo
            </label><br>
        </fieldset>

        <input type="submit" value="Update Preferences">
    </form>

    {% if not preferences.is_paid_user %}
    <button id="checkout-button">Sign Up for Paid Features</button>
    {% endif %}

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.getElementById('checkout-button').addEventListener('click', async () => {
            const response = await fetch('/create-checkout-session', {
                method: 'POST',
            });
            const session = await response.json();
            if (session.url) {
                window.location = session.url;
            } else {
                console.error('Error creating Stripe Checkout session:', session.error);
            }
        });
    </script>
</body>
</html>
